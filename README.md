# **C# Emulator and Parser for Scriptable VM**

### **An Emulator Framework with a Lua-Inspired Script Parser**
**Customizable, extensible, and designed to emulate basic virtual machine instructions and parse scripts for execution.**

---

## **Overview**
This project consists of an emulator and a script parser that enable a simple vm to execute scripted instructions. The emulator mimics Lua-like variables (named registers) and supports advanced features such as stacks, input/output handling, and programmatic control through an easy-to-parse scripting language.

---

## **Features**
- **Instruction Set:** Includes operations like `LOAD`, `ADD`, `MULTIPLY`, `INPUT`, `OUTPUT`, and more.
- **Named Registers:** Allows for Lua-style named variables to simplify instruction handling.
- **Stack Operations:** Push and pop values to/from a stack for advanced computations.
- **Input and Output Handling:** Handles user input and displays output from registers.
- **Script Parsing:** The `Parser` class parses human-readable scripts into bytecode for the emulator.
- **Error Handling:** Detects unknown instructions, invalid arguments, and stack underflows.
- **Extensibility:** Easily add new instructions to both the emulator and the parser.

--

## **Instruction Set**

| **Instruction** | **Opcode** | **Description**                                                                 |
|-----------------|------------|---------------------------------------------------------------------------------|
| `LOAD`          | 1          | Loads a value into a named register.                                           |
| `ADD`           | 2          | Adds a value to a named register.                                              |
| `SUBTRACT`      | 3          | Subtracts a value from a named register.                                       |
| `MULTIPLY`      | 5          | Multiplies a named register by a value.                                        |
| `DIVIDE`        | 6          | Divides a named register by a value (with error handling for division by zero).|
| `PUSH`          | 8          | Pushes the value of a named register onto the stack.                           |
| `POP`           | 9          | Pops the top value from the stack into a named register.                       |
| `INPUT`         | 10         | Prompts the user for input and stores it in a named register.                  |
| `OUTPUT`        | 11         | Outputs the value of a named register to the console.                          |
| `PRINT`         | 4          | Prints all registers and their values.                                         |
| `HALT`          | 99         | Stops the emulator.                                                            |

---

## **How It Works**
The emulator executes a program consisting of numeric opcodes generated by the parser from a script. The parser translates human-readable instructions into the bytecode understood by the emulator.

### **Core Workflow**
1. Write a script using instructions like `LOAD`, `ADD`, and `HALT`.
2. Use the `Parser` to convert the script into an array of integers (bytecode).
3. Load the bytecode into the emulator.
4. Run the emulator to execute the instructions.

---

## **Components**

### **Emulator.cs**
The emulator runs bytecode programs using an instruction set defined as an `enum`.

#### Key Features:
- **Instruction Set:**
  - `LOAD`, `ADD`, `SUBTRACT`, `MULTIPLY`, `DIVIDE`, `PUSH`, `POP`, `INPUT`, `OUTPUT`, `PRINT`, `HALT`
- **Named Registers:** Registers are accessed by string names for simplicity.
- **Error Handling:** Detects invalid operations, such as division by zero.
- **Stack Support:** Provides basic stack operations for storing and retrieving values.

### **Parser.cs**
The parser converts a script into bytecode for the emulator.

#### Key Features:
- **Instruction Mapping:** Maps string instructions like `LOAD` to numeric opcodes.
- **Argument Parsing:** Supports string arguments (e.g., register names) and numeric values.
- **Error Handling:** Detects unknown instructions and invalid arguments.

---

## **Example Script**
```plaintext
LOAD "abc" 10
ADD "abc" 5
INPUT "abc"
OUTPUT "abc"
PRINT
HALT
```

### **Parsed Bytecode**
This script would be converted by the parser into the following bytecode:
```plaintext
1, 3, 'a', 'b', 'c', 10,  // LOAD "abc" 10
2, 3, 'a', 'b', 'c', 5,   // ADD "abc" 5
10, 3, 'a', 'b', 'c',     // INPUT "abc"
11, 3, 'a', 'b', 'c',     // OUTPUT "abc"
4,                        // PRINT
99                        // HALT
```

---

## **How to Use**

### **Program.cs Example**
```csharp
class Program
{
    static void Main(string[] args)
    {
        var emulator = new Emulator(256);
        var parser = new Parser();

        string script = @"
            LOAD \"abc\" 10
            ADD \"abc\" 5
            INPUT \"abc\"
            OUTPUT \"abc\"
            PRINT
            HALT
        ";

        int[] program = parser.Parse(script);
        emulator.LoadProgram(program);
        emulator.Run();

        Console.ReadLine();
    }
}
```

---

## **Use Cases**
1. **Teaching:** Demonstrates fundamental concepts of emulators and script parsing.
2. **Prototyping:** Develops and tests custom instruction sets and scripts.
3. **Learning:** Explores virtual machine architecture and language parsing techniques.

---
